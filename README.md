# landing_designer

Данный проект является бэкенд частью для конструктора лендинга, а так же отчасти показывающий мой опыт в программирование. 

# Установка

Конструктор использует базу данных ``PostgreSQL`` \
Для реализации кэширования используется ``Redis`` \
Для отправки писем используется ``django-post-office`` в совокупности с ``django-anymail`` и ``django-celery-email``

Помимоу утановки ``requirements.txt`` не забудте установить и ``requirements.extra``, а также указать необходимые настройки PostgreSQL, Redis, Django Post Office в ``landing_designer/configuration/local.py``

# Особенности при создание Лендинга

[**Наглядный граф полей и связей моделей лендинга**](graph_landing_models.png)

Данный конструктор позволяет создавать лендинги как в качестве поддомена, так и отдельного сайта. \
За название поддомена отвечает поле ``slug``, а отдельного сайта поле ``alt_url_site`` модели ``Landing``.\
Для обработки поддомена или отдельного сайта используется [SubdomainsMiddleware](landing_designer/middleware.py).

У лендинга есть три обязательных поля ``main_color, second_color, accent_color`` задающие цвета, для всех HTML элементов лендинга 
в виде ``сolor-style.css``, который формируется в представление [ColorStyle](apps/landing/views.py#L86). \
Для манипуляции с цветами используются Sass функции по типу darken, mix взятые из пакета ``pyScss``, а также конвертация в HSL формат изменяя его параметры.


### Блок

Ключевая особенность создания лендинга возможность добавления Блоков, задавая им позицию, возможностью отключения и якорных ссылок. 

Сам Блок изначально в админке имеет два поля ``Название блока`` и ``Шаблон для блока`` остальные поля [скрыты с помощью js](templates/admin/landing/block/change_form.html). 
В зависимости от выбранного шаблона изменяется видимость доступных полей. На данный момент создано **17 шаблонов**:

| Название шаблона       |  Поля блока | Поля связанной модели
| ------------- |:------------------:| :------------------:|
| Приветствие     | Заголовок, подзаголовок, текст кнопки, файл| Описание, приоритет|  
| О продукте     | Заголовок, подзаголовок | - | 
| Особенности  | Заголовок, svg изображение  | Описание, приоритет | 
| Каталог  | Заголовок, каталог  |  -  |
| Форма помощи с выбором  | Заголовок, подзаголовок  | Включен, заголовок, параметры для выбора, селект |
| Сервис  | Заголовок, подзаголовок  | Заголовок, описание, приоритет |
| Премущества покупки  | Заголовок  | Описание, svg изображение, приоритет   |
| Ассортимент продукта  | Заголовок  | Заголовок, описание, приоритет |
| Форма дополнительных предложений  | Заголовок  | Название чекбокса |
| Блок со скрытым текстом  | Заголовок, подзаголовок, текст кнопки  | Заголовок, описание, приоритет, номер колонки, заголовок скрытого текста, скрытый текст   |
| Карта  | Заголовок  | -   |
| О компании  | Заголовок, подзаголовок, описание  | Изображение, имя, должность   |
| Сертификаты  | -  | Изображение, приоритет   |
| Отзывы  | -  | Описание, изображение, приоритет, имя, компания  |
| Партнеры  | - | Изображение, приоритет, ссылка |
| Подписка на рассылку  | -  |  -  |
| Другие предложения  | Заголовок  | - |


Значение для шаблона блока задаются в [apps/landing/constant.py](apps/landing/constant.py), где:

* BLOCK_TEMPLATE_CHOICE -- перечислены шаблоны блока \
* BLOCK_FIELDS_DICT --- данный словарь необходим для отображения полей в админке у Блока.
значение данного словаря является список в котором перечисленны поля Блока, которые будут отображены пример:\
`['subtitle', 'text_button']` - поля Блока \
`['title', ['gallery2block_set-0-image']]` - поле Блока и поле с изображением связанной модели Gallery2Block \
`['title', ['gallery2block_set-0-image', ['id_gallery2block_set-MAX_NUM_FORMS', 4]]]` - тоже самое, но теперь
с указанием максимального количества допустимых экземпляров связанной модели.
* BLOCK_TEMPLATE --- словарь значение которого путь до шаблонов jinja

### Каталог

Каталог относится к блоку имея M2M связь

forms.py:
```python
def label_from_instance(obj):
    url = reverse(f'admin:{obj._meta.app_label}_{obj._meta.model_name}_change', args=[obj.id])
    return f'{obj} <a class="related-widget-wrapper-link" href="{url}?_to_field=id&_popup=1" target="_blank"><img src="/static/admin/img/icon-changelink.svg" alt="Изменить"></a>'


# добавляем возможность редактирования М2М экземпляров
# важно, что бы у поля М2М был виджет с параметром ModelSelect2Multiple(attrs={'data-html': True})
class DalLinkM2MFieldMixin(object):
    dal_m2m_field = ''

    def __init__(self,*args, **kwargs):
        super().__init__(*args, **kwargs)
        if self.dal_m2m_field:
            self.fields[self.dal_m2m_field].label_from_instance = label_from_instance
```

    


